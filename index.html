<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPD Learning Hub | Farillio</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- React & Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        // ‚ïë  üî• FIREBASE CONFIGURATION - REPLACE WITH YOUR OWN CONFIG üî•   ‚ïë
        // ‚ïë  Get this from: Firebase Console ‚Üí Project Settings ‚Üí Your apps ‚ïë
        // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        
        const firebaseConfig = {
            apiKey: "AIzaSyAhy4ixWIzf8fzDaYSfbUY_wO-SkG3q6bo",
            authDomain: "farillio-cpd-hub.firebaseapp.com",
            projectId: "farillio-cpd-hub",
            storageBucket: "farillio-cpd-hub.firebasestorage.app",
            messagingSenderId: "32001885616",
            appId: "1:32001885616:web:5a6794fb6e5257050bc275",
            measurementId: "G-2RK1KHFWD7"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Enable offline persistence
        db.enablePersistence().catch((err) => {
            console.log('Offline persistence not available:', err.code);
        });
    </script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'comet-orange': '#FF5F3C',
                        'classic-green': '#005852',
                        'light-grey': '#EEE8E6',
                        'dark-grey': '#DFD2CE',
                        'neutral-900': '#1D1C1C',
                    },
                    fontFamily: { 'poppins': ['Poppins', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; }
        .progress-ring { transform: rotate(-90deg); }
        .lesson-content h1 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #1D1C1C; }
        .lesson-content h2 { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.75rem; margin-top: 1.5rem; color: #1D1C1C; }
        .lesson-content h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; margin-top: 1rem; color: #423C3D; }
        .lesson-content p { margin-bottom: 1rem; line-height: 1.7; color: #423C3D; }
        .lesson-content ul, .lesson-content ol { margin-bottom: 1rem; padding-left: 1.5rem; }
        .lesson-content li { margin-bottom: 0.5rem; line-height: 1.6; color: #423C3D; }
        .lesson-content strong { font-weight: 600; color: #1D1C1C; }
        .lesson-content blockquote { border-left: 4px solid #FF5F3C; padding-left: 1rem; margin: 1rem 0; font-style: italic; background: #FEF3F2; padding: 1rem; border-radius: 0 8px 8px 0; }
        .lesson-content .key-point { background: #E8F5F3; border-left: 4px solid #005852; padding: 1rem; margin: 1rem 0; border-radius: 0 8px 8px 0; }
        .lesson-content .example { background: #FFF7ED; border: 1px solid #FDBA74; padding: 1rem; margin: 1rem 0; border-radius: 8px; }
        .lesson-content table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
        .lesson-content th, .lesson-content td { border: 1px solid #DFD2CE; padding: 0.75rem; text-align: left; }
        .lesson-content th { background: #EEE8E6; font-weight: 600; }
        .sync-indicator { position: fixed; bottom: 20px; left: 20px; padding: 8px 16px; border-radius: 20px; font-size: 12px; z-index: 100; }
        @media print {
            .no-print { display: none !important; }
            .certificate-page { page-break-after: always; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Icons (condensed for space)
        const Icons = {
            BarChart3: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>,
            BookOpen: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            Award: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg>,
            Clock: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            CheckCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            ChevronLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
            FileText: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Menu: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>,
            Download: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Printer: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></svg>,
            Layers: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 12.5-8.58 3.91a2 2 0 0 1-1.66 0L2 12.5"/><path d="m22 17-8.58 3.91a2 2 0 0 1-1.66 0L2 17"/></svg>,
            LogOut: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>,
            Cloud: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/></svg>,
            CloudOff: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m2 2 20 20"/><path d="M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193"/><path d="M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07"/></svg>,
            Loader: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
        };

        // Course Data (same structure as before, condensed for this file)
        const COURSE_DATA = {
            id: 1,
            title: 'Empowering Brokers: Legal Support, Risk Management & Modern Insurance Practice',
            description: 'This comprehensive CPD programme gives insurance brokers the knowledge, competence and practical skills to better support SMEs.',
            modules: [
                {
                    id: 1, title: 'Module 1: Legal Support for SMEs', subtitle: 'What Brokers Need to Know', duration: 45,
                    objectives: ['Identify key legal pain points of SME clients', 'Explain how legal support enhances insurance products', 'Position legal services credibly and compliantly', 'Spot opportunities to improve client retention'],
                    lessons: [
                        { id: 1, title: 'The SME Legal Landscape', type: 'content', duration: 15, completed: false, content: `<h1>The SME Legal Landscape</h1><p>Small and Medium Enterprises (SMEs) form the backbone of the UK economy, yet many operate without adequate legal protection. As a broker, understanding these challenges positions you as a trusted advisor.</p><h2>Top 10 Legal Risks Facing SMEs</h2><table><tr><th>Risk Area</th><th>Common Issues</th></tr><tr><td><strong>1. Employment Disputes</strong></td><td>Unfair dismissal, discrimination claims</td></tr><tr><td><strong>2. Contract Disputes</strong></td><td>Non-payment, breach of terms</td></tr><tr><td><strong>3. Health & Safety</strong></td><td>Workplace accidents, compliance failures</td></tr><tr><td><strong>4. Data Protection</strong></td><td>GDPR breaches, data loss</td></tr><tr><td><strong>5. Intellectual Property</strong></td><td>Copyright infringement</td></tr></table><div class="key-point"><strong>Key Insight:</strong> 60% of SMEs will face a legal issue within any 3-year period, yet fewer than 30% have any form of legal protection in place.</div>` },
                        { id: 2, title: 'Preventative vs Reactive Legal Behaviour', type: 'content', duration: 10, completed: false, content: `<h1>Preventative vs Reactive Legal Behaviour</h1><p>Most SMEs operate reactively when it comes to legal matters. Understanding this helps you position legal support more effectively.</p><h2>The True Cost of Reactive Behaviour</h2><table><tr><th>Scenario</th><th>Preventative Cost</th><th>Reactive Cost</th></tr><tr><td>Employment contract review</td><td>¬£200-500</td><td>¬£5,000-25,000 (tribunal)</td></tr><tr><td>Commercial contract drafting</td><td>¬£500-1,500</td><td>¬£10,000-50,000 (dispute)</td></tr></table><div class="key-point"><strong>Key Insight:</strong> Businesses that invest in preventative legal measures experience up to 40% fewer claims.</div>` },
                        { id: 3, title: 'Legal Support as Part of Insurance', type: 'content', duration: 12, completed: false, content: `<h1>Legal Support as Part of Insurance Products</h1><p>Modern insurance products increasingly bundle legal support services.</p><h2>Digital Legal Tools & Platforms</h2><table><tr><th>Feature</th><th>Benefit to Client</th></tr><tr><td><strong>Document Templates</strong></td><td>Ready-to-use contracts, policies, letters</td></tr><tr><td><strong>Legal Helplines</strong></td><td>Quick answers to legal questions</td></tr><tr><td><strong>HR Support</strong></td><td>Employment guidance and documentation</td></tr></table>` },
                        { id: 4, title: 'Module 1 Assessment', type: 'quiz', duration: 8, completed: false, questions: [
                            { id: 1, question: 'What percentage of SMEs face a legal issue within 3 years?', options: ['About 30%', 'About 45%', 'About 60%', 'About 80%'], correct: 2 },
                            { id: 2, question: 'Which is the most common legal risk for SMEs?', options: ['Intellectual property', 'Employment disputes', 'Property disputes', 'Tax investigations'], correct: 1 },
                            { id: 3, question: 'Preventative legal behaviour primarily results in:', options: ['Higher costs', 'Reduced claims frequency and severity', 'More documentation', 'Slower processes'], correct: 1 },
                            { id: 4, question: 'How should you describe digital legal tools to clients?', options: ['"This gives you legal advice"', '"You won\'t need a lawyer"', '"This gives you access to legal guidance and information"', '"This covers everything"'], correct: 2 },
                            { id: 5, question: 'Legal platforms help insurers by:', options: ['Increasing claims', 'Reducing claims through early intervention', 'Replacing insurance', 'Avoiding customers'], correct: 1 },
                        ]}
                    ]
                },
                {
                    id: 2, title: 'Module 2: Consumer Duty & Ethical Selling', subtitle: 'For Brokers', duration: 40,
                    objectives: ['Understand FCA Consumer Duty', 'Apply "good outcomes" thinking', 'Recognise misalignment risks', 'Evidence compliance'],
                    lessons: [
                        { id: 1, title: 'The Four Consumer Duty Outcomes', type: 'content', duration: 12, completed: false, content: `<h1>The Four Consumer Duty Outcomes</h1><p>The Consumer Duty came into force on 31 July 2023. As a broker, you play a crucial role in delivering good outcomes.</p><h2>The Consumer Principle</h2><blockquote>"A firm must act to deliver good outcomes for retail customers."</blockquote><h2>The Four Outcomes</h2><ul><li><strong>Outcome 1: Products and Services</strong> - Designed to meet customer needs</li><li><strong>Outcome 2: Price and Value</strong> - Fair value for money</li><li><strong>Outcome 3: Consumer Understanding</strong> - Clear communications</li><li><strong>Outcome 4: Consumer Support</strong> - Accessible help throughout</li></ul>` },
                        { id: 2, title: 'Fair Value and Documentation', type: 'content', duration: 10, completed: false, content: `<h1>Fair Value and Documentation</h1><h2>Fair Value Assessments</h2><p>When assessing fair value for SME clients, consider total cost, core benefits, additional services, and alternatives.</p><div class="example"><strong>‚úÖ Good Practice:</strong> Reviewing cover to remove unnecessary elements that don't benefit the customer.</div><div class="example"><strong>‚ùå Poor Practice:</strong> Recommending premium packages to all clients for higher commission without assessing need.</div>` },
                        { id: 3, title: 'Module 2 Assessment', type: 'quiz', duration: 8, completed: false, questions: [
                            { id: 1, question: 'When did Consumer Duty come into force?', options: ['31 July 2022', '31 July 2023', '1 January 2024', '1 April 2023'], correct: 1 },
                            { id: 2, question: 'How many outcomes does Consumer Duty focus on?', options: ['Two', 'Three', 'Four', 'Five'], correct: 2 },
                            { id: 3, question: 'Consumer Duty Outcome 2 (Price and Value) requires:', options: ['Cheapest option always', 'Price reasonable relative to benefits', 'Ignoring commission', 'Maximum profit'], correct: 1 },
                            { id: 4, question: 'Good documentation should include:', options: ['Only the product sold', 'Customer needs, rationale, and understanding check', 'Just the price', 'Nothing specific'], correct: 1 },
                        ]}
                    ]
                },
                {
                    id: 3, title: 'Module 3: AI, Automation & Future of Insurance', subtitle: 'Distribution', duration: 45,
                    objectives: ['Understand AI in insurance', 'Explain risks and opportunities', 'Identify where brokers add value', 'Discuss digital tools'],
                    lessons: [
                        { id: 1, title: 'What AI Is (and Isn\'t)', type: 'content', duration: 12, completed: false, content: `<h1>What AI Is (and Isn't)</h1><p>AI is transforming insurance, but misconceptions abound.</p><h2>What AI IS Good At</h2><ul><li><strong>Pattern Recognition</strong> - Identifying fraud across thousands of claims</li><li><strong>Data Processing</strong> - Extracting information quickly</li><li><strong>Consistent Decisions</strong> - Applying rules uniformly</li></ul><h2>What AI ISN'T Good At</h2><ul><li><strong>Empathy</strong> - Understanding emotional context</li><li><strong>Novel Situations</strong> - Scenarios not in training data</li><li><strong>Complex Negotiation</strong> - Nuanced discussions</li></ul>` },
                        { id: 2, title: 'Where Brokers Add Value', type: 'content', duration: 12, completed: false, content: `<h1>Where Brokers Add Value</h1><table><tr><th>AI Can Do</th><th>Brokers Do Better</th></tr><tr><td>Process standard applications</td><td>Navigate complex or unusual risks</td></tr><tr><td>Provide instant quotes</td><td>Explain what coverage actually means</td></tr><tr><td>Answer FAQ queries</td><td>Understand unstated concerns</td></tr></table><div class="key-point"><strong>The Future Broker:</strong> Combines technological efficiency with human expertise.</div>` },
                        { id: 3, title: 'Module 3 Assessment', type: 'quiz', duration: 8, completed: false, questions: [
                            { id: 1, question: 'AI is particularly good at:', options: ['Showing empathy', 'Pattern recognition in large datasets', 'Novel situations', 'Ethical judgements'], correct: 1 },
                            { id: 2, question: 'As automation increases, broker value shifts to:', options: ['Routine transactions', 'Complex cases and relationships', 'Price competition only', 'Reducing client contact'], correct: 1 },
                            { id: 3, question: 'The best approach to AI in insurance is:', options: ['AI replaces humans', 'Humans ignore AI', 'AI handles volume; humans handle complexity', 'No AI at all'], correct: 2 },
                        ]}
                    ]
                },
                {
                    id: 4, title: 'Module 4: Risk Management for Small Businesses', subtitle: 'The Broker as Risk Partner', duration: 50,
                    objectives: ['Identify common SME risks', 'Demonstrate risk management value', 'Explain prevention strategies', 'Use risk checklists'],
                    lessons: [
                        { id: 1, title: 'Risk Categories for SMEs', type: 'content', duration: 15, completed: false, content: `<h1>Risk Categories for SMEs</h1><h2>The Five Key Risk Categories</h2><ul><li><strong>Legal Risks</strong> - Employment, contracts, regulatory</li><li><strong>Operational Risks</strong> - Business interruption, supply chain</li><li><strong>Financial Risks</strong> - Credit, cash flow</li><li><strong>Health & Safety Risks</strong> - Workplace, products</li><li><strong>Cyber Risks</strong> - Data breach, ransomware</li></ul><div class="key-point"><strong>Important:</strong> Risks rarely exist in isolation. A cyber attack can trigger operational, legal, and financial consequences.</div>` },
                        { id: 2, title: 'The Broker as Risk Partner', type: 'content', duration: 12, completed: false, content: `<h1>The Broker as Risk Partner</h1><table><tr><th>Policy Adviser</th><th>Risk Partner</th></tr><tr><td>Responds to requests</td><td>Proactively identifies gaps</td></tr><tr><td>Engaged at renewal</td><td>Ongoing relationship</td></tr><tr><td>Reactive to claims</td><td>Works to prevent claims</td></tr></table><div class="key-point"><strong>Retention Impact:</strong> Risk partners see 15-25% higher retention rates.</div>` },
                        { id: 3, title: 'Module 4 Assessment', type: 'quiz', duration: 8, completed: false, questions: [
                            { id: 1, question: 'Which is NOT a key SME risk category?', options: ['Legal', 'Operational', 'Marketing', 'Cyber'], correct: 2 },
                            { id: 2, question: 'A Risk Partner approach means:', options: ['Only engaging at renewal', 'Proactively identifying risk gaps', 'Focusing only on price', 'Being transactional'], correct: 1 },
                            { id: 3, question: 'Good risk management typically results in:', options: ['More claims', 'Fewer claims and better renewal terms', 'Higher premiums', 'Less contact'], correct: 1 },
                        ]}
                    ]
                },
                {
                    id: 5, title: 'Module 5: Policyholder Engagement', subtitle: '& Behavioural Insight', duration: 30,
                    objectives: ['Understand engagement psychology', 'Use communication techniques', 'Help policyholders access tools', 'Improve retention'],
                    lessons: [
                        { id: 1, title: 'Why Policyholders Don\'t Engage', type: 'content', duration: 10, completed: false, content: `<h1>Why Policyholders Don't Engage</h1><p>Added-value services are used by fewer than 20% of policyholders.</p><h2>Psychological Barriers</h2><ul><li><strong>Set and Forget</strong> - Insurance bought and forgotten</li><li><strong>Problem Denial</strong> - "That won't happen to me"</li><li><strong>Complexity Aversion</strong> - Platforms feel like "another thing to learn"</li></ul>` },
                        { id: 2, title: 'Behavioural Triggers', type: 'content', duration: 12, completed: false, content: `<h1>Behavioural Triggers</h1><h2>Key Principles</h2><ul><li><strong>Make It Easy</strong> - Send direct links, offer walkthroughs</li><li><strong>Make It Relevant</strong> - Connect to specific client needs</li><li><strong>Make It Timely</strong> - Link to current events or changes</li><li><strong>Make It Social</strong> - "Many clients in your sector use this..."</li></ul>` },
                        { id: 3, title: 'Module 5 Assessment', type: 'quiz', duration: 8, completed: false, questions: [
                            { id: 1, question: 'What % of policyholders use added-value services?', options: ['Fewer than 20%', 'About 50%', 'Around 75%', 'Over 90%'], correct: 0 },
                            { id: 2, question: '"Make It Easy" means:', options: ['Making it cheaper', 'Reducing obstacles to action', 'Hiding information', 'Adding more steps'], correct: 1 },
                        ]}
                    ]
                },
                {
                    id: 6, title: 'Module 6: Legal Expenses Insurance', subtitle: 'A Practical Guide', duration: 30,
                    objectives: ['Explain what LEI is', 'Understand exclusions and triggers', 'Position LEI to clients', 'Reduce claims friction'],
                    lessons: [
                        { id: 1, title: 'What is Legal Expenses Insurance?', type: 'content', duration: 10, completed: false, content: `<h1>What is Legal Expenses Insurance?</h1><h2>Key Components</h2><ul><li><strong>Indemnity</strong> - Covers legal costs (typically ¬£100k-¬£250k)</li><li><strong>Legal Helpline</strong> - Telephone access to lawyers</li><li><strong>Representation</strong> - Access to panel solicitors</li></ul><h2>The Prospects Test</h2><div class="key-point">Cases must have reasonable prospects of success (usually 51%+). This protects clients from funding hopeless cases.</div>` },
                        { id: 2, title: 'Common Misconceptions', type: 'content', duration: 12, completed: false, content: `<h1>Common Misconceptions</h1><div class="example"><strong>‚ùå Myth:</strong> "LEI covers all my legal costs"<br><strong>‚úÖ Reality:</strong> LEI covers insured events that pass the prospects test.</div><div class="example"><strong>‚ùå Myth:</strong> "I can use any solicitor"<br><strong>‚úÖ Reality:</strong> Usually panel solicitors until court proceedings start.</div>` },
                        { id: 3, title: 'Module 6 Assessment', type: 'quiz', duration: 8, completed: false, questions: [
                            { id: 1, question: 'LEI stands for:', options: ['Legal Employment Insurance', 'Legal Expenses Insurance', 'Limited Expense Indemnity', 'Liability Expenses Insurance'], correct: 1 },
                            { id: 2, question: 'The typical prospects test requires:', options: ['25% chance', '51% chance', '75% chance', '90% chance'], correct: 1 },
                            { id: 3, question: 'When should clients notify LEI claims?', options: ['Only when payment needed', 'After case concludes', 'Early, before formal disputes', 'Never'], correct: 2 },
                        ]}
                    ]
                }
            ]
        };

        // Firebase Sync Hook
        const useFirebaseSync = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [syncStatus, setSyncStatus] = useState('checking'); // checking, online, offline, syncing
            const [userData, setUserData] = useState(null);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (firebaseUser) => {
                    setUser(firebaseUser);
                    if (firebaseUser) {
                        // Load user data from Firestore
                        try {
                            const doc = await db.collection('users').doc(firebaseUser.uid).get();
                            if (doc.exists) {
                                setUserData(doc.data());
                            }
                            setSyncStatus('online');
                        } catch (err) {
                            console.log('Offline or error:', err);
                            setSyncStatus('offline');
                            // Try to load from local storage as fallback
                            const local = localStorage.getItem('cpdUserData');
                            if (local) setUserData(JSON.parse(local));
                        }
                    }
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const saveUserData = async (data) => {
                setUserData(data);
                localStorage.setItem('cpdUserData', JSON.stringify(data)); // Always save locally
                
                if (user) {
                    setSyncStatus('syncing');
                    try {
                        await db.collection('users').doc(user.uid).set(data, { merge: true });
                        setSyncStatus('online');
                    } catch (err) {
                        console.log('Save error (will sync later):', err);
                        setSyncStatus('offline');
                    }
                }
            };

            const signUp = async (email, password, profile) => {
                const cred = await auth.createUserWithEmailAndPassword(email, password);
                const initialData = {
                    profile,
                    progress: JSON.parse(JSON.stringify(COURSE_DATA)),
                    certificates: [],
                    createdAt: new Date().toISOString()
                };
                await db.collection('users').doc(cred.user.uid).set(initialData);
                setUserData(initialData);
                return cred.user;
            };

            const signIn = async (email, password) => {
                const cred = await auth.signInWithEmailAndPassword(email, password);
                const doc = await db.collection('users').doc(cred.user.uid).get();
                if (doc.exists) setUserData(doc.data());
                return cred.user;
            };

            const signOut = async () => {
                await auth.signOut();
                setUserData(null);
                localStorage.removeItem('cpdUserData');
            };

            return { user, loading, syncStatus, userData, saveUserData, signUp, signIn, signOut };
        };

        // Main App
        function App() {
            const { user, loading, syncStatus, userData, saveUserData, signUp, signIn, signOut } = useFirebaseSync();
            const [view, setView] = useState('auth');
            const [authMode, setAuthMode] = useState('login');
            const [activeModule, setActiveModule] = useState(null);
            const [activeLesson, setActiveLesson] = useState(null);
            const [showMobileMenu, setShowMobileMenu] = useState(false);
            const [quizAnswers, setQuizAnswers] = useState({});
            const [quizSubmitted, setQuizSubmitted] = useState(false);
            const [notification, setNotification] = useState(null);
            const [viewingCertificate, setViewingCertificate] = useState(null);
            const [authError, setAuthError] = useState('');

            const notify = (msg, type = 'success') => {
                setNotification({ msg, type });
                setTimeout(() => setNotification(null), 3000);
            };

            // Set view based on auth state
            useEffect(() => {
                if (!loading) {
                    setView(user && userData ? 'dashboard' : 'auth');
                }
            }, [user, userData, loading]);

            // Calculate progress
            const calculateProgress = () => {
                if (!userData?.progress?.modules) return { totalLessons: 0, completedLessons: 0, percentage: 0 };
                let total = 0, completed = 0;
                userData.progress.modules.forEach(m => {
                    m.lessons.forEach(l => {
                        total++;
                        if (l.completed) completed++;
                    });
                });
                return { totalLessons: total, completedLessons: completed, percentage: total ? Math.round((completed / total) * 100) : 0 };
            };

            const progress = calculateProgress();
            const totalHours = 4;
            const completedHours = Math.round((progress.percentage / 100) * totalHours * 10) / 10;

            // Complete lesson
            const completeLesson = async (moduleId, lessonId) => {
                const newData = JSON.parse(JSON.stringify(userData));
                const module = newData.progress.modules.find(m => m.id === moduleId);
                const lesson = module.lessons.find(l => l.id === lessonId);
                lesson.completed = true;
                
                const allComplete = module.lessons.every(l => l.completed);
                if (allComplete && !newData.certificates.find(c => c.moduleId === moduleId)) {
                    newData.certificates.push({
                        id: Date.now(),
                        moduleId,
                        moduleTitle: module.title,
                        moduleSubtitle: module.subtitle,
                        duration: module.duration,
                        objectives: module.objectives,
                        completedDate: new Date().toISOString().split('T')[0],
                        userName: newData.profile.name,
                        userCompany: newData.profile.company
                    });
                    notify(`üéâ Module Complete! Certificate earned!`);
                }
                await saveUserData(newData);
            };

            // Submit quiz
            const submitQuiz = async (moduleId, lessonId, questions) => {
                let correct = 0;
                questions.forEach(q => {
                    if (quizAnswers[q.id] === q.correct) correct++;
                });
                const score = Math.round((correct / questions.length) * 100);
                setQuizSubmitted(true);
                
                if (score >= 70) {
                    await completeLesson(moduleId, lessonId);
                    notify(`‚úÖ Passed! Score: ${score}%`);
                } else {
                    notify(`Score: ${score}%. Need 70% to pass.`, 'error');
                }
            };

            // Auth handlers
            const handleSignUp = async (e) => {
                e.preventDefault();
                setAuthError('');
                const form = e.target;
                try {
                    await signUp(form.email.value, form.password.value, {
                        name: form.name.value,
                        company: form.company.value || ''
                    });
                    notify('Account created successfully!');
                } catch (err) {
                    setAuthError(err.message);
                }
            };

            const handleSignIn = async (e) => {
                e.preventDefault();
                setAuthError('');
                const form = e.target;
                try {
                    await signIn(form.email.value, form.password.value);
                    notify('Welcome back!');
                } catch (err) {
                    setAuthError(err.message.includes('user-not-found') ? 'Account not found' : 
                                 err.message.includes('wrong-password') ? 'Incorrect password' : err.message);
                }
            };

            // Progress Ring
            const ProgressRing = ({ pct, size = 100, stroke = 8 }) => {
                const r = (size - stroke) / 2;
                const c = r * 2 * Math.PI;
                const offset = c - (pct / 100) * c;
                return (
                    <svg width={size} height={size} style={{ transform: 'rotate(-90deg)' }}>
                        <circle cx={size/2} cy={size/2} r={r} fill="none" stroke="#DFD2CE" strokeWidth={stroke} />
                        <circle cx={size/2} cy={size/2} r={r} fill="none" stroke="#FF5F3C" strokeWidth={stroke}
                            strokeDasharray={c} strokeDashoffset={offset} strokeLinecap="round" />
                    </svg>
                );
            };

            // Sync Status Indicator
            const SyncIndicator = () => (
                <div className={`sync-indicator flex items-center gap-2 ${
                    syncStatus === 'online' ? 'bg-green-100 text-green-700' :
                    syncStatus === 'offline' ? 'bg-yellow-100 text-yellow-700' :
                    syncStatus === 'syncing' ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-500'
                }`}>
                    {syncStatus === 'online' && <><Icons.Cloud /> Synced</>}
                    {syncStatus === 'offline' && <><Icons.CloudOff /> Offline</>}
                    {syncStatus === 'syncing' && <><Icons.Loader /> Syncing...</>}
                </div>
            );

            // Certificate Component
            const Certificate = ({ cert, onClose }) => (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-auto">
                    <div className="bg-white rounded-2xl max-w-3xl w-full max-h-[95vh] overflow-auto">
                        <div className="p-4 border-b flex justify-between items-center no-print">
                            <h2 className="font-semibold">Certificate of Completion</h2>
                            <div className="flex gap-2">
                                <button onClick={() => window.print()} className="flex items-center gap-2 px-4 py-2 bg-comet-orange text-white rounded-lg">
                                    <Icons.Printer /> Print / Save PDF
                                </button>
                                <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-lg"><Icons.X /></button>
                            </div>
                        </div>
                        <div className="p-8 certificate-page">
                            <div className="border-8 border-double border-comet-orange p-8">
                                <div className="text-center mb-8">
                                    <div className="flex items-center justify-center gap-3 mb-4">
                                        <div className="w-12 h-12 rounded-lg bg-comet-orange flex items-center justify-center">
                                            <span className="text-white font-bold text-2xl">F</span>
                                        </div>
                                        <span className="text-2xl font-bold text-neutral-900">farillio</span>
                                    </div>
                                </div>
                                <div className="text-center mb-8">
                                    <h1 className="text-3xl font-bold text-neutral-900 mb-2">Certificate of Completion</h1>
                                    <p className="text-neutral-500">This is to certify that</p>
                                </div>
                                <div className="text-center mb-8">
                                    <p className="text-3xl font-bold text-comet-orange mb-2">{cert.userName}</p>
                                    {cert.userCompany && <p className="text-neutral-500">{cert.userCompany}</p>}
                                </div>
                                <div className="text-center mb-8">
                                    <p className="text-neutral-500 mb-2">has successfully completed</p>
                                    <p className="text-2xl font-bold text-neutral-900">{cert.moduleTitle}</p>
                                    <p className="text-lg text-classic-green">{cert.moduleSubtitle}</p>
                                </div>
                                <div className="bg-light-grey rounded-lg p-4 mb-8">
                                    <p className="font-semibold mb-2">Learning Objectives:</p>
                                    <ul className="text-sm space-y-1">
                                        {cert.objectives.map((obj, i) => <li key={i}>‚Ä¢ {obj}</li>)}
                                    </ul>
                                </div>
                                <div className="flex justify-between items-end">
                                    <div>
                                        <p className="text-sm text-neutral-500">Date</p>
                                        <p className="font-semibold">{cert.completedDate}</p>
                                    </div>
                                    <div className="text-center">
                                        <p className="font-bold text-comet-orange">{cert.duration} min CPD</p>
                                    </div>
                                    <div className="text-right">
                                        <p className="text-sm text-neutral-500">ID</p>
                                        <p className="font-mono text-sm">{cert.id}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // Auth Screen
            const AuthScreen = () => (
                <div className="min-h-screen bg-gradient-to-br from-neutral-900 to-neutral-800 flex items-center justify-center p-4">
                    <div className="max-w-md w-full">
                        <div className="text-center mb-8">
                            <div className="flex items-center justify-center gap-3 mb-4">
                                <div className="w-14 h-14 rounded-xl bg-comet-orange flex items-center justify-center">
                                    <span className="text-white font-bold text-3xl">F</span>
                                </div>
                                <span className="text-3xl font-bold text-white">farillio</span>
                            </div>
                            <p className="text-neutral-400">CPD Learning Hub</p>
                        </div>

                        <div className="bg-white rounded-2xl p-8 shadow-xl">
                            <div className="flex mb-6">
                                <button onClick={() => { setAuthMode('login'); setAuthError(''); }} 
                                    className={`flex-1 py-2 text-center font-medium rounded-l-lg ${authMode === 'login' ? 'bg-comet-orange text-white' : 'bg-gray-100'}`}>
                                    Sign In
                                </button>
                                <button onClick={() => { setAuthMode('signup'); setAuthError(''); }} 
                                    className={`flex-1 py-2 text-center font-medium rounded-r-lg ${authMode === 'signup' ? 'bg-comet-orange text-white' : 'bg-gray-100'}`}>
                                    Create Account
                                </button>
                            </div>

                            {authError && <div className="mb-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm">{authError}</div>}

                            {authMode === 'login' ? (
                                <form onSubmit={handleSignIn} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Email</label>
                                        <input type="email" name="email" required className="w-full px-4 py-3 rounded-lg border focus:outline-none focus:border-comet-orange" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Password</label>
                                        <input type="password" name="password" required className="w-full px-4 py-3 rounded-lg border focus:outline-none focus:border-comet-orange" />
                                    </div>
                                    <button type="submit" className="w-full py-3 rounded-xl bg-comet-orange text-white font-semibold hover:bg-orange-600">
                                        Sign In
                                    </button>
                                </form>
                            ) : (
                                <form onSubmit={handleSignUp} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Full Name *</label>
                                        <input type="text" name="name" required className="w-full px-4 py-3 rounded-lg border focus:outline-none focus:border-comet-orange" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Company</label>
                                        <input type="text" name="company" className="w-full px-4 py-3 rounded-lg border focus:outline-none focus:border-comet-orange" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Email *</label>
                                        <input type="email" name="email" required className="w-full px-4 py-3 rounded-lg border focus:outline-none focus:border-comet-orange" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Password * (min 6 characters)</label>
                                        <input type="password" name="password" required minLength={6} className="w-full px-4 py-3 rounded-lg border focus:outline-none focus:border-comet-orange" />
                                    </div>
                                    <button type="submit" className="w-full py-3 rounded-xl bg-comet-orange text-white font-semibold hover:bg-orange-600">
                                        Create Account & Start Learning
                                    </button>
                                </form>
                            )}
                        </div>
                    </div>
                </div>
            );

            // Lesson Viewer
            const LessonViewer = ({ module, lesson, onBack }) => {
                const idx = module.lessons.findIndex(l => l.id === lesson.id);
                const next = module.lessons[idx + 1];
                const prev = module.lessons[idx - 1];

                return (
                    <div className="max-w-4xl mx-auto">
                        <button onClick={onBack} className="flex items-center gap-2 text-neutral-500 hover:text-comet-orange mb-6">
                            <Icons.ChevronLeft /> Back to {module.title}
                        </button>

                        <div className="bg-white rounded-xl shadow-sm overflow-hidden">
                            <div className="p-6 border-b">
                                <span className="px-3 py-1 rounded-full text-xs bg-comet-orange/10 text-comet-orange font-medium">
                                    Lesson {idx + 1} of {module.lessons.length}
                                </span>
                                <h1 className="text-2xl font-bold text-neutral-900 mt-2">{lesson.title}</h1>
                            </div>

                            <div className="p-6">
                                {lesson.type === 'content' && (
                                    <div className="lesson-content" dangerouslySetInnerHTML={{ __html: lesson.content }} />
                                )}

                                {lesson.type === 'quiz' && (
                                    <div className="space-y-6">
                                        {lesson.questions.map((q, qIdx) => (
                                            <div key={q.id} className="p-4 bg-neutral-50 rounded-lg border">
                                                <p className="font-semibold mb-3">Q{qIdx + 1}. {q.question}</p>
                                                <div className="space-y-2">
                                                    {q.options.map((opt, oIdx) => (
                                                        <label key={oIdx} className={`flex items-center gap-3 p-3 rounded-lg cursor-pointer ${
                                                            quizAnswers[q.id] === oIdx ? 'bg-comet-orange/10 border-2 border-comet-orange' : 'bg-white border-2 border-transparent'
                                                        } ${quizSubmitted && oIdx === q.correct ? 'bg-green-100 border-green-500' : ''} 
                                                        ${quizSubmitted && quizAnswers[q.id] === oIdx && oIdx !== q.correct ? 'bg-red-100 border-red-500' : ''}`}>
                                                            <input type="radio" name={`q-${q.id}`} 
                                                                checked={quizAnswers[q.id] === oIdx}
                                                                onChange={() => !quizSubmitted && setQuizAnswers({...quizAnswers, [q.id]: oIdx})}
                                                                disabled={quizSubmitted} className="accent-comet-orange w-4 h-4" />
                                                            <span>{opt}</span>
                                                        </label>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                        
                                        {!quizSubmitted ? (
                                            <button onClick={() => submitQuiz(module.id, lesson.id, lesson.questions)}
                                                disabled={Object.keys(quizAnswers).length < lesson.questions.length}
                                                className="w-full py-3 rounded-xl bg-comet-orange text-white font-semibold disabled:opacity-50">
                                                Submit Assessment
                                            </button>
                                        ) : (
                                            <button onClick={() => { setQuizAnswers({}); setQuizSubmitted(false); }}
                                                className="w-full py-3 rounded-xl bg-neutral-200 text-neutral-700 font-semibold">
                                                Retry
                                            </button>
                                        )}
                                    </div>
                                )}
                            </div>

                            <div className="p-6 border-t bg-neutral-50 flex justify-between items-center">
                                {prev ? (
                                    <button onClick={() => { setActiveLesson(prev); setQuizAnswers({}); setQuizSubmitted(false); }}
                                        className="flex items-center gap-2 text-neutral-500 hover:text-comet-orange">
                                        <Icons.ChevronLeft /> Previous
                                    </button>
                                ) : <div />}

                                {!lesson.completed && lesson.type !== 'quiz' && (
                                    <button onClick={() => completeLesson(module.id, lesson.id)}
                                        className="px-6 py-2 rounded-lg bg-classic-green text-white font-medium">
                                        Mark Complete
                                    </button>
                                )}

                                {next ? (
                                    <button onClick={() => { setActiveLesson(next); setQuizAnswers({}); setQuizSubmitted(false); window.scrollTo(0,0); }}
                                        className="flex items-center gap-2 text-comet-orange font-medium">
                                        Next <Icons.ChevronRight />
                                    </button>
                                ) : <span className="text-classic-green font-medium">Module Complete</span>}
                            </div>
                        </div>
                    </div>
                );
            };

            // Module View
            const ModuleView = ({ module, onBack }) => {
                const cert = userData?.certificates?.find(c => c.moduleId === module.id);
                const completedCount = module.lessons.filter(l => l.completed).length;

                return (
                    <div className="max-w-4xl mx-auto">
                        <button onClick={onBack} className="flex items-center gap-2 text-neutral-500 hover:text-comet-orange mb-6">
                            <Icons.ChevronLeft /> Back
                        </button>

                        <div className="bg-white rounded-xl p-6 shadow-sm mb-6">
                            <h1 className="text-2xl font-bold text-neutral-900">{module.title}</h1>
                            <p className="text-classic-green">{module.subtitle}</p>
                            <p className="text-sm text-neutral-500 mt-2">{module.duration} minutes ‚Ä¢ {module.lessons.length} lessons</p>
                            
                            {cert && (
                                <button onClick={() => setViewingCertificate(cert)}
                                    className="mt-4 flex items-center gap-2 px-4 py-2 bg-classic-green text-white rounded-lg">
                                    <Icons.Award /> View Certificate
                                </button>
                            )}
                        </div>

                        <div className="space-y-3">
                            {module.lessons.map((lesson, idx) => (
                                <div key={lesson.id} onClick={() => setActiveLesson(lesson)}
                                    className={`bg-white rounded-xl p-4 shadow-sm flex items-center gap-4 cursor-pointer hover:shadow-md ${
                                        lesson.completed ? 'border-l-4 border-classic-green' : ''
                                    }`}>
                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center font-semibold ${
                                        lesson.completed ? 'bg-classic-green text-white' : 'bg-light-grey text-neutral-500'
                                    }`}>
                                        {lesson.completed ? '‚úì' : idx + 1}
                                    </div>
                                    <div className="flex-1">
                                        <h3 className="font-medium">{lesson.title}</h3>
                                        <p className="text-sm text-neutral-500">{lesson.type === 'quiz' ? 'üìù Quiz' : 'üìñ Reading'} ‚Ä¢ {lesson.duration} min</p>
                                    </div>
                                    <button className="px-4 py-2 rounded-lg bg-comet-orange text-white text-sm">
                                        {lesson.completed ? 'Review' : 'Start'}
                                    </button>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            // Dashboard
            const Dashboard = () => (
                <div className="space-y-6">
                    <div className="flex justify-between items-start">
                        <div>
                            <h1 className="text-2xl font-bold text-neutral-900">Welcome, {userData?.profile?.name}</h1>
                            <p className="text-neutral-500">Continue your CPD training</p>
                        </div>
                        <button onClick={signOut} className="flex items-center gap-2 px-4 py-2 text-neutral-500 hover:text-comet-orange">
                            <Icons.LogOut /> Sign Out
                        </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="bg-white rounded-xl p-6 shadow-sm">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-neutral-500">Progress</p>
                                    <p className="text-3xl font-bold">{progress.percentage}%</p>
                                    <p className="text-sm text-neutral-500">{progress.completedLessons}/{progress.totalLessons} lessons</p>
                                </div>
                                <div className="relative">
                                    <ProgressRing pct={progress.percentage} />
                                    <div className="absolute inset-0 flex items-center justify-center">
                                        <span className="text-xl font-bold text-comet-orange">{progress.percentage}%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl p-6 shadow-sm">
                            <p className="text-sm text-neutral-500">CPD Hours</p>
                            <p className="text-2xl font-bold">{completedHours}h / {totalHours}h</p>
                            <div className="mt-3 h-2 rounded-full bg-light-grey">
                                <div className="h-2 rounded-full bg-comet-orange" style={{ width: `${progress.percentage}%` }} />
                            </div>
                        </div>

                        <div className="bg-white rounded-xl p-6 shadow-sm">
                            <p className="text-sm text-neutral-500">Certificates</p>
                            <p className="text-2xl font-bold">{userData?.certificates?.length || 0} / 6</p>
                            {userData?.certificates?.length > 0 && (
                                <button onClick={() => setView('certificates')} className="mt-2 text-sm text-comet-orange">
                                    View Certificates ‚Üí
                                </button>
                            )}
                        </div>
                    </div>

                    <div className="space-y-4">
                        <h2 className="text-xl font-semibold">Modules</h2>
                        {userData?.progress?.modules?.map((module, idx) => {
                            const completed = module.lessons.filter(l => l.completed).length;
                            const total = module.lessons.length;
                            const isComplete = completed === total;
                            
                            return (
                                <div key={module.id} onClick={() => setActiveModule(module)}
                                    className={`bg-white rounded-xl p-5 shadow-sm cursor-pointer hover:shadow-md ${isComplete ? 'border-l-4 border-classic-green' : ''}`}>
                                    <div className="flex items-center gap-4">
                                        <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-xl font-bold ${
                                            isComplete ? 'bg-classic-green text-white' : 'bg-comet-orange/10 text-comet-orange'
                                        }`}>
                                            {isComplete ? '‚úì' : idx + 1}
                                        </div>
                                        <div className="flex-1">
                                            <h3 className="font-semibold">{module.title}</h3>
                                            <p className="text-sm text-classic-green">{module.subtitle}</p>
                                            <p className="text-sm text-neutral-500">{module.duration} min ‚Ä¢ {total} lessons</p>
                                            {completed > 0 && !isComplete && (
                                                <div className="mt-2 h-1.5 rounded-full bg-light-grey w-32">
                                                    <div className="h-1.5 rounded-full bg-comet-orange" style={{ width: `${(completed/total)*100}%` }} />
                                                </div>
                                            )}
                                        </div>
                                        <button className="px-4 py-2 rounded-lg bg-comet-orange text-white text-sm">
                                            {isComplete ? 'Review' : completed > 0 ? 'Continue' : 'Start'}
                                        </button>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );

            // Certificates View
            const CertificatesView = () => (
                <div className="space-y-6">
                    <div className="flex items-center gap-4">
                        <button onClick={() => setView('dashboard')} className="text-neutral-500 hover:text-comet-orange">
                            <Icons.ChevronLeft />
                        </button>
                        <h1 className="text-2xl font-bold">My Certificates</h1>
                    </div>
                    
                    {userData?.certificates?.length > 0 ? (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            {userData.certificates.map(cert => (
                                <div key={cert.id} className="bg-white rounded-xl p-6 shadow-sm border-2 border-dashed border-classic-green/30">
                                    <h3 className="font-semibold">{cert.moduleTitle}</h3>
                                    <p className="text-sm text-classic-green">{cert.moduleSubtitle}</p>
                                    <p className="text-sm text-neutral-500 mt-2">Completed: {cert.completedDate}</p>
                                    <button onClick={() => setViewingCertificate(cert)}
                                        className="mt-4 w-full py-2 rounded-lg bg-classic-green text-white">
                                        View Certificate
                                    </button>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="text-center py-16 bg-white rounded-xl">
                            <p className="text-neutral-500">Complete modules to earn certificates!</p>
                        </div>
                    )}
                </div>
            );

            // Loading
            if (loading) {
                return (
                    <div className="min-h-screen bg-neutral-100 flex items-center justify-center">
                        <div className="text-center">
                            <Icons.Loader />
                            <p className="mt-4 text-neutral-500">Loading...</p>
                        </div>
                    </div>
                );
            }

            // Auth
            if (view === 'auth' || !user) return <AuthScreen />;

            // Main App
            return (
                <div className="min-h-screen flex bg-neutral-100 font-poppins">
                    <button onClick={() => setShowMobileMenu(!showMobileMenu)} 
                        className="md:hidden fixed top-4 left-4 z-50 p-2 rounded-lg bg-neutral-900 text-white">
                        {showMobileMenu ? <Icons.X /> : <Icons.Menu />}
                    </button>

                    <div className={`fixed md:static inset-y-0 left-0 z-40 w-64 bg-neutral-900 p-4 flex flex-col transform transition-transform ${
                        showMobileMenu ? 'translate-x-0' : '-translate-x-full md:translate-x-0'
                    }`}>
                        <div className="mb-8 px-4 pt-8 md:pt-0">
                            <div className="flex items-center gap-2">
                                <div className="w-10 h-10 rounded-lg bg-comet-orange flex items-center justify-center">
                                    <span className="text-white font-bold text-xl">F</span>
                                </div>
                                <span className="text-white font-semibold text-lg">farillio</span>
                            </div>
                            <p className="text-xs mt-2 text-neutral-500">CPD Learning Hub</p>
                        </div>

                        <nav className="flex-1 space-y-1">
                            <button onClick={() => { setView('dashboard'); setActiveModule(null); setActiveLesson(null); setShowMobileMenu(false); }}
                                className={`flex items-center gap-3 w-full px-4 py-3 rounded-lg ${view === 'dashboard' ? 'bg-comet-orange text-white' : 'text-neutral-400 hover:text-white'}`}>
                                <Icons.BarChart3 /> Dashboard
                            </button>
                            <button onClick={() => { setView('certificates'); setShowMobileMenu(false); }}
                                className={`flex items-center gap-3 w-full px-4 py-3 rounded-lg ${view === 'certificates' ? 'bg-comet-orange text-white' : 'text-neutral-400 hover:text-white'}`}>
                                <Icons.Award /> Certificates
                            </button>
                        </nav>

                        <div className="border-t border-gray-700 pt-4">
                            <div className="px-4 py-2">
                                <p className="text-white font-medium truncate">{userData?.profile?.name}</p>
                                <p className="text-xs text-neutral-500 truncate">{user?.email}</p>
                            </div>
                            <button onClick={signOut} className="flex items-center gap-3 w-full px-4 py-3 text-neutral-400 hover:text-white">
                                <Icons.LogOut /> Sign Out
                            </button>
                        </div>
                    </div>

                    <div className="flex-1 p-4 md:p-8 overflow-auto pt-16 md:pt-8">
                        {activeLesson && activeModule ? (
                            <LessonViewer module={activeModule} lesson={activeLesson} 
                                onBack={() => { setActiveLesson(null); setQuizAnswers({}); setQuizSubmitted(false); }} />
                        ) : activeModule ? (
                            <ModuleView module={activeModule} onBack={() => setActiveModule(null)} />
                        ) : view === 'certificates' ? (
                            <CertificatesView />
                        ) : (
                            <Dashboard />
                        )}
                    </div>

                    <SyncIndicator />

                    {viewingCertificate && (
                        <Certificate cert={viewingCertificate} onClose={() => setViewingCertificate(null)} />
                    )}

                    {notification && (
                        <div className={`fixed bottom-4 right-4 px-6 py-3 rounded-xl shadow-lg text-white font-medium z-50 ${
                            notification.type === 'error' ? 'bg-red-500' : 'bg-classic-green'
                        }`}>
                            {notification.msg}
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
