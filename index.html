<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPD Learning Hub | Farillio</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'comet-orange': '#FF5F3C',
                        'classic-green': '#005852',
                        'light-grey': '#EEE8E6',
                        'dark-grey': '#DFD2CE',
                        'neutral-900': '#1D1C1C',
                        'neutral-700': '#423C3D',
                        'neutral-500': '#B0A2A5',
                        'neutral-300': '#EEE8E6',
                        'neutral-100': '#FBF9F9',
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; }
        .progress-ring { transform: rotate(-90deg); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .lesson-content h1 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; }
        .lesson-content h2 { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.75rem; margin-top: 1.5rem; }
        .lesson-content h3 { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; margin-top: 1rem; }
        .lesson-content p { margin-bottom: 1rem; line-height: 1.7; }
        .lesson-content ul, .lesson-content ol { margin-bottom: 1rem; padding-left: 1.5rem; }
        .lesson-content li { margin-bottom: 0.5rem; line-height: 1.6; }
        .lesson-content strong { font-weight: 600; }
        .lesson-content blockquote { border-left: 4px solid #FF5F3C; padding-left: 1rem; margin: 1rem 0; font-style: italic; color: #666; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const Icons = {
            BarChart3: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>,
            BookOpen: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            TrendingUp: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
            Award: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg>,
            Calendar: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Settings: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            Bell: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>,
            User: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
            Clock: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            CheckCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            Play: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            ChevronLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
            FileText: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>,
            Video: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2" ry="2"/></svg>,
            Headphones: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3"/></svg>,
            Star: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
            Trophy: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
            Target: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Menu: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Download: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Edit: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            FolderPlus: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 10v6"/><path d="M9 13h6"/><path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"/></svg>,
            FilePlus: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="12" x2="12" y1="18" y2="12"/><line x1="9" x2="15" y1="15" y2="15"/></svg>,
            HelpCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>,
            Link: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
            Upload: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            Save: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
            Layers: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 12.5-8.58 3.91a2 2 0 0 1-1.66 0L2 12.5"/><path d="m22 17-8.58 3.91a2 2 0 0 1-1.66 0L2 17"/></svg>,
        };

        // Sample course with full content
        const getInitialData = () => {
            const saved = localStorage.getItem('cpdHubDataV2');
            if (saved) return JSON.parse(saved);
            
            return {
                user: { name: 'Sarah', email: 'sarah@example.com', isAdmin: true },
                courses: [
                    { 
                        id: 1, 
                        title: 'Consumer Duty Fundamentals', 
                        category: 'Regulatory', 
                        duration: 2.5, 
                        progress: 0, 
                        type: 'structured', 
                        status: 'not-started',
                        completedDate: null,
                        description: 'Understand the FCA Consumer Duty and how it applies to insurance professionals.',
                        lessons: [
                            {
                                id: 1,
                                title: 'Introduction to Consumer Duty',
                                type: 'content',
                                duration: 30,
                                completed: false,
                                content: `<h1>Introduction to Consumer Duty</h1>
<p>The Consumer Duty is a new FCA regulation that came into force on 31 July 2023. It sets higher expectations for firms in their treatment of retail customers.</p>

<h2>What is the Consumer Duty?</h2>
<p>The Consumer Duty requires firms to act to deliver good outcomes for retail customers. It's built around a new Consumer Principle that requires firms to:</p>

<blockquote>"Act to deliver good outcomes for retail customers"</blockquote>

<h2>The Four Outcomes</h2>
<p>The Consumer Duty focuses on four key outcomes:</p>
<ul>
<li><strong>Products and Services</strong> - Products and services are designed to meet the needs of consumers and sold to those whose needs they meet</li>
<li><strong>Price and Value</strong> - Price of products and services represents fair value for consumers</li>
<li><strong>Consumer Understanding</strong> - Firms communicate in a way that supports consumer understanding</li>
<li><strong>Consumer Support</strong> - Firms provide support that meets consumers' needs</li>
</ul>

<h2>Why Does This Matter?</h2>
<p>As an insurance professional, you play a crucial role in ensuring customers receive good outcomes. This means:</p>
<ul>
<li>Understanding your customers' needs before recommending products</li>
<li>Communicating clearly without jargon</li>
<li>Ensuring products offer fair value</li>
<li>Supporting customers throughout their journey</li>
</ul>

<p>In the next lesson, we'll explore each of the four outcomes in more detail.</p>`
                            },
                            {
                                id: 2,
                                title: 'The Four Consumer Outcomes',
                                type: 'content',
                                duration: 45,
                                completed: false,
                                content: `<h1>The Four Consumer Outcomes</h1>
<p>Let's explore each of the four Consumer Duty outcomes in detail.</p>

<h2>1. Products and Services</h2>
<p>Products must be designed with the target customer in mind. You should:</p>
<ul>
<li>Understand who the product is designed for</li>
<li>Identify who the product is NOT suitable for</li>
<li>Only recommend products to customers in the target market</li>
<li>Regularly review products to ensure they still meet customer needs</li>
</ul>

<h2>2. Price and Value</h2>
<p>The price a customer pays must be reasonable relative to the benefits they receive. Consider:</p>
<ul>
<li>What does the customer get for their money?</li>
<li>Are there cheaper alternatives that would better suit their needs?</li>
<li>Are any add-ons or extras genuinely valuable to this customer?</li>
</ul>

<h2>3. Consumer Understanding</h2>
<p>All communications must be clear, fair and not misleading:</p>
<ul>
<li>Use plain English - avoid jargon</li>
<li>Highlight key information prominently</li>
<li>Test communications with real customers</li>
<li>Consider vulnerable customers' needs</li>
</ul>

<h2>4. Consumer Support</h2>
<p>Support should be as easy to access as sales:</p>
<ul>
<li>Make it easy for customers to contact you</li>
<li>Don't create unreasonable barriers to claims or complaints</li>
<li>Provide support through appropriate channels</li>
<li>Train staff to identify and support vulnerable customers</li>
</ul>`
                            },
                            {
                                id: 3,
                                title: 'Knowledge Check',
                                type: 'quiz',
                                duration: 15,
                                completed: false,
                                questions: [
                                    {
                                        id: 1,
                                        question: 'When did the Consumer Duty come into force?',
                                        options: ['31 July 2022', '31 July 2023', '1 January 2024', '31 December 2023'],
                                        correct: 1
                                    },
                                    {
                                        id: 2,
                                        question: 'How many key outcomes does the Consumer Duty focus on?',
                                        options: ['Two', 'Three', 'Four', 'Five'],
                                        correct: 2
                                    },
                                    {
                                        id: 3,
                                        question: 'Which of the following is NOT one of the four Consumer Duty outcomes?',
                                        options: ['Products and Services', 'Price and Value', 'Consumer Profits', 'Consumer Support'],
                                        correct: 2
                                    },
                                    {
                                        id: 4,
                                        question: 'What does the Consumer Duty require firms to do?',
                                        options: [
                                            'Maximise profits at all costs',
                                            'Act to deliver good outcomes for retail customers',
                                            'Sell as many products as possible',
                                            'Reduce customer service costs'
                                        ],
                                        correct: 1
                                    }
                                ]
                            },
                            {
                                id: 4,
                                title: 'Practical Application',
                                type: 'content',
                                duration: 30,
                                completed: false,
                                content: `<h1>Putting Consumer Duty into Practice</h1>
<p>Now that you understand the theory, let's look at how to apply Consumer Duty in your daily work.</p>

<h2>Before Recommending a Product</h2>
<p>Ask yourself these questions:</p>
<ul>
<li>Is this customer in the target market for this product?</li>
<li>Have I understood their needs, characteristics and objectives?</li>
<li>Does the product represent fair value for THIS customer?</li>
<li>Have I explained the product clearly?</li>
</ul>

<h2>Case Study: Mrs Jones</h2>
<p>Mrs Jones, 72, comes to you for travel insurance. She has a pre-existing heart condition and is travelling to Spain for 2 weeks.</p>

<h3>Good Practice:</h3>
<ul>
<li>Ask about her specific health conditions</li>
<li>Explain what is and isn't covered clearly</li>
<li>Ensure the policy covers her pre-existing condition</li>
<li>Check the price represents fair value</li>
<li>Provide documentation in a format she can understand</li>
</ul>

<h3>Poor Practice:</h3>
<ul>
<li>Selling a standard policy without asking about health</li>
<li>Not explaining exclusions</li>
<li>Using technical jargon</li>
<li>Making it difficult to claim</li>
</ul>

<h2>Key Takeaways</h2>
<p>Always put the customer at the heart of everything you do. If you wouldn't recommend a product to a family member, don't recommend it to a customer.</p>`
                            }
                        ]
                    },
                    { 
                        id: 2, 
                        title: 'FCA Conduct Rules 2024', 
                        category: 'Compliance', 
                        duration: 1.5, 
                        progress: 0, 
                        type: 'structured', 
                        status: 'not-started',
                        completedDate: null,
                        description: 'Learn about the FCA Individual Conduct Rules and your responsibilities.',
                        lessons: [
                            {
                                id: 1,
                                title: 'Introduction to Conduct Rules',
                                type: 'content',
                                duration: 30,
                                completed: false,
                                content: `<h1>FCA Individual Conduct Rules</h1>
<p>The FCA's Individual Conduct Rules apply to almost everyone who works in financial services. This lesson explains what they are and why they matter.</p>

<h2>The Six Individual Conduct Rules</h2>
<p>There are six rules that apply to most staff:</p>

<ol>
<li><strong>Rule 1:</strong> You must act with integrity</li>
<li><strong>Rule 2:</strong> You must act with due skill, care and diligence</li>
<li><strong>Rule 3:</strong> You must be open and cooperative with the FCA, PRA and other regulators</li>
<li><strong>Rule 4:</strong> You must pay due regard to the interests of customers and treat them fairly</li>
<li><strong>Rule 5:</strong> You must observe proper standards of market conduct</li>
<li><strong>Rule 6:</strong> You must act to deliver good outcomes for retail customers (Consumer Duty)</li>
</ol>

<h2>Why Do These Rules Exist?</h2>
<p>These rules ensure that everyone in financial services maintains high standards of conduct. Breaching these rules can lead to disciplinary action by your employer and potentially action by the FCA.</p>`
                            },
                            {
                                id: 2,
                                title: 'Knowledge Check',
                                type: 'quiz',
                                duration: 15,
                                completed: false,
                                questions: [
                                    {
                                        id: 1,
                                        question: 'How many Individual Conduct Rules are there?',
                                        options: ['Four', 'Five', 'Six', 'Seven'],
                                        correct: 2
                                    },
                                    {
                                        id: 2,
                                        question: 'Which rule requires you to treat customers fairly?',
                                        options: ['Rule 1', 'Rule 2', 'Rule 4', 'Rule 6'],
                                        correct: 2
                                    }
                                ]
                            }
                        ]
                    },
                    { 
                        id: 3, 
                        title: 'Vulnerable Customers', 
                        category: 'Customer Service', 
                        duration: 2, 
                        progress: 0, 
                        type: 'structured', 
                        status: 'not-started',
                        completedDate: null,
                        description: 'How to identify and support vulnerable customers effectively.',
                        lessons: []
                    },
                ],
                unstructuredContent: [
                    { id: 1, title: 'Insurance Industry Trends 2025', type: 'Article', duration: 0.5, category: 'Industry', completed: false, url: '' },
                    { id: 2, title: 'FCA Quarterly Update Podcast', type: 'Podcast', duration: 0.75, category: 'Regulatory', completed: false, url: '' },
                ],
                achievements: [
                    { id: 1, title: 'First Steps', description: 'Complete your first course', earned: false },
                    { id: 2, title: 'Quiz Master', description: 'Score 100% on a quiz', earned: false },
                    { id: 3, title: 'Knowledge Seeker', description: 'Log 20 hours of CPD', earned: false },
                ],
                cpdYear: { start: '2024-04-01', end: '2025-03-31' }
            };
        };

        function CPDLearningHub() {
            const [data, setData] = useState(getInitialData);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [activeCourse, setActiveCourse] = useState(null);
            const [activeLesson, setActiveLesson] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [filterCategory, setFilterCategory] = useState('All');
            const [showMobileMenu, setShowMobileMenu] = useState(false);
            const [notification, setNotification] = useState(null);
            const [quizAnswers, setQuizAnswers] = useState({});
            const [quizSubmitted, setQuizSubmitted] = useState(false);
            const [editingCourse, setEditingCourse] = useState(null);
            const [editingLesson, setEditingLesson] = useState(null);

            useEffect(() => {
                localStorage.setItem('cpdHubDataV2', JSON.stringify(data));
            }, [data]);

            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 3000);
            };

            // Calculate hours
            const calculateHours = () => {
                let structured = 0;
                data.courses.forEach(course => {
                    if (course.status === 'completed') {
                        structured += course.duration;
                    } else if (course.lessons && course.lessons.length > 0) {
                        const completedLessons = course.lessons.filter(l => l.completed).length;
                        const totalLessons = course.lessons.length;
                        structured += (completedLessons / totalLessons) * course.duration;
                    }
                });
                const unstructured = data.unstructuredContent.filter(c => c.completed).reduce((sum, c) => sum + c.duration, 0);
                return {
                    structured: Math.round(structured * 10) / 10,
                    unstructured: Math.round(unstructured * 10) / 10,
                    total: Math.round((structured + unstructured) * 10) / 10
                };
            };

            const hours = calculateHours();
            const totalRequired = 35;
            const structuredRequired = 21;
            const daysRemaining = Math.max(0, Math.ceil((new Date(data.cpdYear.end) - new Date()) / (1000 * 60 * 60 * 24)));

            // Complete a lesson
            const completeLesson = (courseId, lessonId) => {
                setData(prev => ({
                    ...prev,
                    courses: prev.courses.map(c => {
                        if (c.id === courseId) {
                            const updatedLessons = c.lessons.map(l => 
                                l.id === lessonId ? { ...l, completed: true } : l
                            );
                            const allCompleted = updatedLessons.every(l => l.completed);
                            const completedCount = updatedLessons.filter(l => l.completed).length;
                            const progress = Math.round((completedCount / updatedLessons.length) * 100);
                            return {
                                ...c,
                                lessons: updatedLessons,
                                progress,
                                status: allCompleted ? 'completed' : 'in-progress',
                                completedDate: allCompleted ? new Date().toISOString().split('T')[0] : null
                            };
                        }
                        return c;
                    })
                }));
                showNotification('Lesson completed! ðŸŽ‰');
            };

            // Submit quiz
            const submitQuiz = (courseId, lessonId, questions) => {
                let correct = 0;
                questions.forEach(q => {
                    if (quizAnswers[q.id] === q.correct) correct++;
                });
                const score = Math.round((correct / questions.length) * 100);
                setQuizSubmitted(true);
                
                if (score >= 70) {
                    completeLesson(courseId, lessonId);
                    showNotification(`Quiz passed! Score: ${score}%`);
                } else {
                    showNotification(`Score: ${score}%. You need 70% to pass. Try again!`, 'error');
                }
            };

            // Add new course
            const addCourse = (courseData) => {
                const newCourse = {
                    id: Date.now(),
                    ...courseData,
                    progress: 0,
                    status: 'not-started',
                    completedDate: null,
                    lessons: []
                };
                setData(prev => ({ ...prev, courses: [...prev.courses, newCourse] }));
                showNotification('Course created successfully!');
                setEditingCourse(null);
            };

            // Update course
            const updateCourse = (courseId, courseData) => {
                setData(prev => ({
                    ...prev,
                    courses: prev.courses.map(c => c.id === courseId ? { ...c, ...courseData } : c)
                }));
                showNotification('Course updated successfully!');
                setEditingCourse(null);
            };

            // Delete course
            const deleteCourse = (courseId) => {
                if (confirm('Are you sure you want to delete this course?')) {
                    setData(prev => ({
                        ...prev,
                        courses: prev.courses.filter(c => c.id !== courseId)
                    }));
                    showNotification('Course deleted');
                }
            };

            // Add lesson to course
            const addLesson = (courseId, lessonData) => {
                setData(prev => ({
                    ...prev,
                    courses: prev.courses.map(c => {
                        if (c.id === courseId) {
                            return {
                                ...c,
                                lessons: [...(c.lessons || []), { id: Date.now(), completed: false, ...lessonData }]
                            };
                        }
                        return c;
                    })
                }));
                showNotification('Lesson added successfully!');
                setEditingLesson(null);
            };

            // Update lesson
            const updateLesson = (courseId, lessonId, lessonData) => {
                setData(prev => ({
                    ...prev,
                    courses: prev.courses.map(c => {
                        if (c.id === courseId) {
                            return {
                                ...c,
                                lessons: c.lessons.map(l => l.id === lessonId ? { ...l, ...lessonData } : l)
                            };
                        }
                        return c;
                    })
                }));
                showNotification('Lesson updated!');
                setEditingLesson(null);
            };

            // Delete lesson
            const deleteLesson = (courseId, lessonId) => {
                if (confirm('Delete this lesson?')) {
                    setData(prev => ({
                        ...prev,
                        courses: prev.courses.map(c => {
                            if (c.id === courseId) {
                                return { ...c, lessons: c.lessons.filter(l => l.id !== lessonId) };
                            }
                            return c;
                        })
                    }));
                    showNotification('Lesson deleted');
                }
            };

            // Progress Ring
            const ProgressRing = ({ progress, size = 120, strokeWidth = 10 }) => {
                const radius = (size - strokeWidth) / 2;
                const circumference = radius * 2 * Math.PI;
                const offset = circumference - (progress / 100) * circumference;
                return (
                    <svg width={size} height={size} className="progress-ring">
                        <circle cx={size/2} cy={size/2} r={radius} fill="none" stroke="#DFD2CE" strokeWidth={strokeWidth} />
                        <circle cx={size/2} cy={size/2} r={radius} fill="none" stroke="#FF5F3C" strokeWidth={strokeWidth}
                            strokeDasharray={circumference} strokeDashoffset={offset} strokeLinecap="round" />
                    </svg>
                );
            };

            // Nav Item
            const NavItem = ({ icon: Icon, label, id }) => (
                <button onClick={() => { setActiveTab(id); setShowMobileMenu(false); setActiveCourse(null); setActiveLesson(null); }}
                    className={`flex items-center gap-3 w-full px-4 py-3 rounded-lg transition-all ${
                        activeTab === id ? 'bg-comet-orange text-white' : 'text-neutral-400 hover:text-white hover:bg-white/10'
                    }`}>
                    <Icon /><span className="font-medium">{label}</span>
                </button>
            );

            // Course Editor Modal
            const CourseEditor = ({ course, onSave, onClose }) => {
                const [form, setForm] = useState(course || {
                    title: '', category: 'Regulatory', duration: 1, type: 'structured', description: ''
                });
                const categories = ['Regulatory', 'Compliance', 'Customer Service', 'Claims', 'Products', 'Skills'];
                
                return (
                    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                        <div className="bg-white rounded-2xl max-w-lg w-full p-6">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-xl font-bold">{course ? 'Edit Course' : 'Create New Course'}</h2>
                                <button onClick={onClose} className="text-gray-400 hover:text-gray-600"><Icons.X /></button>
                            </div>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium mb-1">Course Title</label>
                                    <input type="text" value={form.title} onChange={e => setForm({...form, title: e.target.value})}
                                        className="w-full px-4 py-2 rounded-lg border focus:outline-none focus:border-comet-orange"
                                        placeholder="e.g. Consumer Duty Fundamentals" />
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Category</label>
                                        <select value={form.category} onChange={e => setForm({...form, category: e.target.value})}
                                            className="w-full px-4 py-2 rounded-lg border focus:outline-none focus:border-comet-orange">
                                            {categories.map(c => <option key={c} value={c}>{c}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Duration (hours)</label>
                                        <input type="number" step="0.5" min="0.5" value={form.duration} 
                                            onChange={e => setForm({...form, duration: parseFloat(e.target.value)})}
                                            className="w-full px-4 py-2 rounded-lg border focus:outline-none focus:border-comet-orange" />
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-1">Description</label>
                                    <textarea value={form.description} onChange={e => setForm({...form, description: e.target.value})}
                                        rows={3} className="w-full px-4 py-2 rounded-lg border focus:outline-none focus:border-comet-orange"
                                        placeholder="What will learners gain from this course?" />
                                </div>
                                <button onClick={() => onSave(form)} disabled={!form.title}
                                    className="w-full py-3 rounded-xl bg-comet-orange text-white font-semibold hover:bg-orange-600 disabled:opacity-50">
                                    {course ? 'Save Changes' : 'Create Course'}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Lesson Editor Modal
            const LessonEditor = ({ courseId, lesson, onSave, onClose }) => {
                const [form, setForm] = useState(lesson || {
                    title: '', type: 'content', duration: 30, content: '', questions: []
                });
                const [newQuestion, setNewQuestion] = useState({ question: '', options: ['', '', '', ''], correct: 0 });

                const addQuestion = () => {
                    if (newQuestion.question && newQuestion.options.every(o => o)) {
                        setForm({ ...form, questions: [...(form.questions || []), { ...newQuestion, id: Date.now() }] });
                        setNewQuestion({ question: '', options: ['', '', '', ''], correct: 0 });
                    }
                };

                const removeQuestion = (qId) => {
                    setForm({ ...form, questions: form.questions.filter(q => q.id !== qId) });
                };

                return (
                    <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-auto">
                        <div className="bg-white rounded-2xl max-w-2xl w-full p-6 my-8 max-h-[90vh] overflow-auto">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-xl font-bold">{lesson ? 'Edit Lesson' : 'Add New Lesson'}</h2>
                                <button onClick={onClose} className="text-gray-400 hover:text-gray-600"><Icons.X /></button>
                            </div>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium mb-1">Lesson Title</label>
                                    <input type="text" value={form.title} onChange={e => setForm({...form, title: e.target.value})}
                                        className="w-full px-4 py-2 rounded-lg border focus:outline-none focus:border-comet-orange" />
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Type</label>
                                        <select value={form.type} onChange={e => setForm({...form, type: e.target.value})}
                                            className="w-full px-4 py-2 rounded-lg border focus:outline-none focus:border-comet-orange">
                                            <option value="content">Content/Reading</option>
                                            <option value="video">Video</option>
                                            <option value="quiz">Quiz</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Duration (minutes)</label>
                                        <input type="number" min="5" value={form.duration} 
                                            onChange={e => setForm({...form, duration: parseInt(e.target.value)})}
                                            className="w-full px-4 py-2 rounded-lg border focus:outline-none focus:border-comet-orange" />
                                    </div>
                                </div>

                                {form.type === 'content' && (
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Content (HTML supported)</label>
                                        <textarea value={form.content} onChange={e => setForm({...form, content: e.target.value})}
                                            rows={12} className="w-full px-4 py-2 rounded-lg border focus:outline-none focus:border-comet-orange font-mono text-sm"
                                            placeholder="<h1>Lesson Title</h1>&#10;<p>Your content here...</p>&#10;<ul><li>Point 1</li></ul>" />
                                        <p className="text-xs text-gray-500 mt-1">Use HTML tags: h1, h2, h3, p, ul, ol, li, strong, blockquote</p>
                                    </div>
                                )}

                                {form.type === 'video' && (
                                    <div>
                                        <label className="block text-sm font-medium mb-1">Video URL (YouTube, Vimeo, or MP4)</label>
                                        <input type="url" value={form.videoUrl || ''} 
                                            onChange={e => setForm({...form, videoUrl: e.target.value})}
                                            className="w-full px-4 py-2 rounded-lg border focus:outline-none focus:border-comet-orange"
                                            placeholder="https://www.youtube.com/watch?v=..." />
                                    </div>
                                )}

                                {form.type === 'quiz' && (
                                    <div className="space-y-4">
                                        <label className="block text-sm font-medium">Quiz Questions</label>
                                        
                                        {form.questions && form.questions.map((q, idx) => (
                                            <div key={q.id} className="p-3 bg-gray-50 rounded-lg">
                                                <div className="flex justify-between">
                                                    <p className="font-medium">Q{idx + 1}: {q.question}</p>
                                                    <button onClick={() => removeQuestion(q.id)} className="text-red-500 text-sm">Remove</button>
                                                </div>
                                                <p className="text-sm text-gray-500 mt-1">Correct: {q.options[q.correct]}</p>
                                            </div>
                                        ))}

                                        <div className="p-4 border-2 border-dashed rounded-lg space-y-3">
                                            <p className="font-medium text-sm">Add Question</p>
                                            <input type="text" value={newQuestion.question}
                                                onChange={e => setNewQuestion({...newQuestion, question: e.target.value})}
                                                className="w-full px-3 py-2 rounded border text-sm" placeholder="Question text" />
                                            {newQuestion.options.map((opt, i) => (
                                                <div key={i} className="flex gap-2 items-center">
                                                    <input type="radio" name="correct" checked={newQuestion.correct === i}
                                                        onChange={() => setNewQuestion({...newQuestion, correct: i})} />
                                                    <input type="text" value={opt}
                                                        onChange={e => {
                                                            const opts = [...newQuestion.options];
                                                            opts[i] = e.target.value;
                                                            setNewQuestion({...newQuestion, options: opts});
                                                        }}
                                                        className="flex-1 px-3 py-2 rounded border text-sm" 
                                                        placeholder={`Option ${i + 1}`} />
                                                </div>
                                            ))}
                                            <button onClick={addQuestion} className="px-4 py-2 bg-classic-green text-white rounded-lg text-sm">
                                                Add Question
                                            </button>
                                        </div>
                                    </div>
                                )}

                                <button onClick={() => onSave(form)} disabled={!form.title}
                                    className="w-full py-3 rounded-xl bg-comet-orange text-white font-semibold hover:bg-orange-600 disabled:opacity-50">
                                    {lesson ? 'Save Changes' : 'Add Lesson'}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            // Lesson Viewer
            const LessonViewer = ({ course, lesson, onBack, onComplete }) => {
                const currentIndex = course.lessons.findIndex(l => l.id === lesson.id);
                const nextLesson = course.lessons[currentIndex + 1];
                const prevLesson = course.lessons[currentIndex - 1];

                return (
                    <div className="max-w-4xl mx-auto">
                        <button onClick={onBack} className="flex items-center gap-2 text-neutral-500 hover:text-comet-orange mb-6">
                            <Icons.ChevronLeft /> Back to {course.title}
                        </button>

                        <div className="bg-white rounded-xl shadow-sm overflow-hidden">
                            <div className="p-6 border-b">
                                <div className="flex items-center gap-3 mb-2">
                                    <span className="px-3 py-1 rounded-full text-xs bg-light-grey text-neutral-700">
                                        Lesson {currentIndex + 1} of {course.lessons.length}
                                    </span>
                                    {lesson.completed && <span className="text-classic-green"><Icons.CheckCircle /></span>}
                                </div>
                                <h1 className="text-2xl font-bold text-neutral-900">{lesson.title}</h1>
                                <p className="text-neutral-500 flex items-center gap-2 mt-2">
                                    <Icons.Clock /> {lesson.duration} minutes
                                </p>
                            </div>

                            <div className="p-6">
                                {lesson.type === 'content' && (
                                    <div className="lesson-content text-neutral-700" 
                                        dangerouslySetInnerHTML={{ __html: lesson.content }} />
                                )}

                                {lesson.type === 'video' && lesson.videoUrl && (
                                    <div className="aspect-video bg-black rounded-lg overflow-hidden">
                                        {lesson.videoUrl.includes('youtube') ? (
                                            <iframe 
                                                src={lesson.videoUrl.replace('watch?v=', 'embed/')}
                                                className="w-full h-full" allowFullScreen />
                                        ) : (
                                            <video src={lesson.videoUrl} controls className="w-full h-full" />
                                        )}
                                    </div>
                                )}

                                {lesson.type === 'quiz' && (
                                    <div className="space-y-6">
                                        {lesson.questions.map((q, qIdx) => (
                                            <div key={q.id} className="p-4 bg-neutral-100 rounded-lg">
                                                <p className="font-semibold mb-3">Q{qIdx + 1}. {q.question}</p>
                                                <div className="space-y-2">
                                                    {q.options.map((opt, oIdx) => (
                                                        <label key={oIdx} className={`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all ${
                                                            quizAnswers[q.id] === oIdx ? 'bg-comet-orange/10 border-2 border-comet-orange' : 'bg-white border-2 border-transparent hover:border-gray-200'
                                                        } ${quizSubmitted && oIdx === q.correct ? 'bg-green-100 border-green-500' : ''} ${quizSubmitted && quizAnswers[q.id] === oIdx && oIdx !== q.correct ? 'bg-red-100 border-red-500' : ''}`}>
                                                            <input type="radio" name={`q-${q.id}`} 
                                                                checked={quizAnswers[q.id] === oIdx}
                                                                onChange={() => !quizSubmitted && setQuizAnswers({...quizAnswers, [q.id]: oIdx})}
                                                                disabled={quizSubmitted}
                                                                className="accent-comet-orange" />
                                                            <span>{opt}</span>
                                                        </label>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                        
                                        {!quizSubmitted ? (
                                            <button onClick={() => submitQuiz(course.id, lesson.id, lesson.questions)}
                                                disabled={Object.keys(quizAnswers).length < lesson.questions.length}
                                                className="w-full py-3 rounded-xl bg-comet-orange text-white font-semibold hover:bg-orange-600 disabled:opacity-50">
                                                Submit Quiz
                                            </button>
                                        ) : (
                                            <button onClick={() => { setQuizAnswers({}); setQuizSubmitted(false); }}
                                                className="w-full py-3 rounded-xl bg-neutral-200 text-neutral-700 font-semibold hover:bg-neutral-300">
                                                Try Again
                                            </button>
                                        )}
                                    </div>
                                )}
                            </div>

                            <div className="p-6 border-t bg-neutral-50 flex justify-between items-center">
                                {prevLesson ? (
                                    <button onClick={() => { setActiveLesson(prevLesson); setQuizAnswers({}); setQuizSubmitted(false); }}
                                        className="flex items-center gap-2 text-neutral-500 hover:text-comet-orange">
                                        <Icons.ChevronLeft /> Previous
                                    </button>
                                ) : <div />}

                                {!lesson.completed && lesson.type !== 'quiz' && (
                                    <button onClick={() => onComplete(course.id, lesson.id)}
                                        className="px-6 py-2 rounded-lg bg-classic-green text-white font-medium hover:bg-green-700">
                                        Mark Complete
                                    </button>
                                )}

                                {nextLesson ? (
                                    <button onClick={() => { setActiveLesson(nextLesson); setQuizAnswers({}); setQuizSubmitted(false); }}
                                        className="flex items-center gap-2 text-comet-orange hover:text-orange-600">
                                        Next <Icons.ChevronRight />
                                    </button>
                                ) : (
                                    <span className="text-classic-green font-medium">Course Complete!</span>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            // Course Detail View
            const CourseDetail = ({ course, onBack }) => (
                <div className="max-w-4xl mx-auto">
                    <button onClick={onBack} className="flex items-center gap-2 text-neutral-500 hover:text-comet-orange mb-6">
                        <Icons.ChevronLeft /> Back to Courses
                    </button>

                    <div className="bg-white rounded-xl p-6 shadow-sm mb-6">
                        <div className="flex flex-col md:flex-row md:items-start justify-between gap-4">
                            <div>
                                <div className="flex items-center gap-3 mb-2">
                                    <span className="px-3 py-1 rounded-full text-sm bg-light-grey text-neutral-700">{course.category}</span>
                                    {course.status === 'completed' && <span className="text-classic-green"><Icons.CheckCircle /></span>}
                                </div>
                                <h1 className="text-2xl font-bold text-neutral-900 mb-2">{course.title}</h1>
                                <p className="text-neutral-500 mb-4">{course.description}</p>
                                <div className="flex items-center gap-4 text-sm text-neutral-500">
                                    <span className="flex items-center gap-1"><Icons.Clock /> {course.duration} hours</span>
                                    <span>{course.lessons?.length || 0} lessons</span>
                                </div>
                            </div>
                            {data.user.isAdmin && (
                                <div className="flex gap-2">
                                    <button onClick={() => setEditingCourse(course)} 
                                        className="p-2 rounded-lg hover:bg-gray-100 text-neutral-500"><Icons.Edit /></button>
                                    <button onClick={() => deleteCourse(course.id)} 
                                        className="p-2 rounded-lg hover:bg-red-50 text-red-500"><Icons.Trash /></button>
                                </div>
                            )}
                        </div>

                        {course.progress > 0 && course.progress < 100 && (
                            <div className="mt-6">
                                <div className="flex justify-between text-sm mb-2">
                                    <span className="text-neutral-500">Your Progress</span>
                                    <span className="text-comet-orange font-semibold">{course.progress}%</span>
                                </div>
                                <div className="h-3 rounded-full bg-light-grey">
                                    <div className="h-3 rounded-full bg-comet-orange transition-all" style={{ width: `${course.progress}%` }} />
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="flex items-center justify-between mb-4">
                        <h2 className="text-xl font-semibold text-neutral-900">Lessons</h2>
                        {data.user.isAdmin && (
                            <button onClick={() => setEditingLesson({ courseId: course.id })}
                                className="flex items-center gap-2 px-4 py-2 rounded-lg bg-comet-orange text-white hover:bg-orange-600">
                                <Icons.Plus /> Add Lesson
                            </button>
                        )}
                    </div>

                    {course.lessons && course.lessons.length > 0 ? (
                        <div className="space-y-3">
                            {course.lessons.map((lesson, idx) => (
                                <div key={lesson.id} 
                                    className={`bg-white rounded-xl p-4 shadow-sm flex items-center gap-4 hover:shadow-md transition-all ${
                                        lesson.completed ? 'border-l-4 border-classic-green' : ''
                                    }`}>
                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center ${
                                        lesson.completed ? 'bg-classic-green text-white' : 'bg-light-grey text-neutral-500'
                                    }`}>
                                        {lesson.completed ? <Icons.CheckCircle /> : idx + 1}
                                    </div>
                                    <div className="flex-1 cursor-pointer" onClick={() => setActiveLesson(lesson)}>
                                        <h3 className="font-medium text-neutral-900">{lesson.title}</h3>
                                        <p className="text-sm text-neutral-500 flex items-center gap-2">
                                            {lesson.type === 'quiz' ? 'Quiz' : lesson.type === 'video' ? 'Video' : 'Reading'}
                                            <span>â€¢</span>
                                            {lesson.duration} min
                                        </p>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        {data.user.isAdmin && (
                                            <>
                                                <button onClick={() => setEditingLesson({ courseId: course.id, lesson })}
                                                    className="p-2 rounded-lg hover:bg-gray-100 text-neutral-400"><Icons.Edit /></button>
                                                <button onClick={() => deleteLesson(course.id, lesson.id)}
                                                    className="p-2 rounded-lg hover:bg-red-50 text-red-400"><Icons.Trash /></button>
                                            </>
                                        )}
                                        <button onClick={() => setActiveLesson(lesson)}
                                            className="px-4 py-2 rounded-lg bg-comet-orange text-white text-sm hover:bg-orange-600">
                                            {lesson.completed ? 'Review' : 'Start'}
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="text-center py-12 bg-white rounded-xl">
                            <div className="text-neutral-400 flex justify-center mb-4"><Icons.FileText /></div>
                            <p className="text-neutral-500">No lessons yet.</p>
                            {data.user.isAdmin && (
                                <button onClick={() => setEditingLesson({ courseId: course.id })}
                                    className="mt-4 px-6 py-2 rounded-lg bg-comet-orange text-white">
                                    Add First Lesson
                                </button>
                            )}
                        </div>
                    )}
                </div>
            );

            // Dashboard
            const Dashboard = () => (
                <div className="space-y-6">
                    <div className="flex items-center justify-between">
                        <div>
                            <h1 className="text-2xl font-bold text-neutral-900">Welcome back, {data.user.name}</h1>
                            <p className="text-neutral-500">Keep up the great work on your CPD journey!</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="bg-white rounded-xl p-6 shadow-sm">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-neutral-500 mb-1">Total CPD Progress</p>
                                    <p className="text-3xl font-bold text-neutral-900">
                                        {hours.total}<span className="text-lg font-normal text-neutral-500"> / {totalRequired}h</span>
                                    </p>
                                </div>
                                <div className="relative">
                                    <ProgressRing progress={(hours.total / totalRequired) * 100} />
                                    <div className="absolute inset-0 flex items-center justify-center">
                                        <span className="text-2xl font-bold text-comet-orange">{Math.round((hours.total / totalRequired) * 100)}%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl p-6 shadow-sm">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-10 h-10 rounded-lg bg-light-grey flex items-center justify-center text-comet-orange"><Icons.BookOpen /></div>
                                <div>
                                    <p className="text-sm text-neutral-500">Structured CPD</p>
                                    <p className="text-xl font-bold text-neutral-900">{hours.structured}h / {structuredRequired}h</p>
                                </div>
                            </div>
                            <div className="h-2 rounded-full bg-light-grey">
                                <div className="h-2 rounded-full bg-comet-orange" style={{ width: `${Math.min(100, (hours.structured / structuredRequired) * 100)}%` }} />
                            </div>
                        </div>

                        <div className="bg-white rounded-xl p-6 shadow-sm">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-10 h-10 rounded-lg bg-light-grey flex items-center justify-center text-classic-green"><Icons.Headphones /></div>
                                <div>
                                    <p className="text-sm text-neutral-500">Unstructured CPD</p>
                                    <p className="text-xl font-bold text-neutral-900">{hours.unstructured}h / 14h</p>
                                </div>
                            </div>
                            <div className="h-2 rounded-full bg-light-grey">
                                <div className="h-2 rounded-full bg-classic-green" style={{ width: `${Math.min(100, (hours.unstructured / 14) * 100)}%` }} />
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div className="bg-white rounded-xl p-4 shadow-sm text-center">
                            <div className="text-comet-orange flex justify-center mb-2"><Icons.Calendar /></div>
                            <p className="text-2xl font-bold text-neutral-900">{daysRemaining}</p>
                            <p className="text-sm text-neutral-500">Days Remaining</p>
                        </div>
                        <div className="bg-white rounded-xl p-4 shadow-sm text-center">
                            <div className="text-comet-orange flex justify-center mb-2"><Icons.Award /></div>
                            <p className="text-2xl font-bold text-neutral-900">{data.courses.filter(c => c.status === 'completed').length}</p>
                            <p className="text-sm text-neutral-500">Completed</p>
                        </div>
                        <div className="bg-white rounded-xl p-4 shadow-sm text-center">
                            <div className="text-comet-orange flex justify-center mb-2"><Icons.BookOpen /></div>
                            <p className="text-2xl font-bold text-neutral-900">{data.courses.filter(c => c.status === 'in-progress').length}</p>
                            <p className="text-sm text-neutral-500">In Progress</p>
                        </div>
                        <div className="bg-white rounded-xl p-4 shadow-sm text-center">
                            <div className="text-comet-orange flex justify-center mb-2"><Icons.Layers /></div>
                            <p className="text-2xl font-bold text-neutral-900">{data.courses.length}</p>
                            <p className="text-sm text-neutral-500">Total Courses</p>
                        </div>
                    </div>

                    <div>
                        <div className="flex items-center justify-between mb-4">
                            <h2 className="text-xl font-semibold text-neutral-900">Continue Learning</h2>
                            <button onClick={() => setActiveTab('courses')} className="text-sm font-medium text-comet-orange flex items-center gap-1">
                                View All <Icons.ChevronRight />
                            </button>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {data.courses.filter(c => c.status !== 'completed').slice(0, 3).map(course => (
                                <div key={course.id} onClick={() => setActiveCourse(course)}
                                    className="bg-white rounded-xl p-5 shadow-sm hover:shadow-md transition-all cursor-pointer">
                                    <div className="flex items-start justify-between mb-3">
                                        <div className="w-12 h-12 rounded-lg bg-light-grey flex items-center justify-center text-comet-orange">
                                            <Icons.FileText />
                                        </div>
                                        {course.status === 'in-progress' && (
                                            <span className="px-2 py-1 rounded-full text-xs bg-orange-100 text-comet-orange">In Progress</span>
                                        )}
                                    </div>
                                    <h3 className="font-semibold mb-2">{course.title}</h3>
                                    <div className="flex items-center gap-3 text-sm text-neutral-500 mb-3">
                                        <span className="flex items-center gap-1"><Icons.Clock /> {course.duration}h</span>
                                        <span>{course.lessons?.length || 0} lessons</span>
                                    </div>
                                    {course.progress > 0 && (
                                        <div className="h-2 rounded-full bg-light-grey">
                                            <div className="h-2 rounded-full bg-comet-orange" style={{ width: `${course.progress}%` }} />
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );

            // Courses List
            const CoursesList = () => {
                const categories = ['All', ...new Set(data.courses.map(c => c.category))];
                const filtered = data.courses.filter(c => 
                    (filterCategory === 'All' || c.category === filterCategory) &&
                    c.title.toLowerCase().includes(searchQuery.toLowerCase())
                );

                return (
                    <div className="space-y-6">
                        <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                            <h1 className="text-2xl font-bold text-neutral-900">Course Library</h1>
                            <div className="flex gap-3">
                                <div className="relative">
                                    <span className="absolute left-3 top-1/2 -translate-y-1/2 text-neutral-500"><Icons.Search /></span>
                                    <input type="text" placeholder="Search..." value={searchQuery} onChange={e => setSearchQuery(e.target.value)}
                                        className="pl-10 pr-4 py-2 rounded-lg border focus:outline-none focus:border-comet-orange" />
                                </div>
                                {data.user.isAdmin && (
                                    <button onClick={() => setEditingCourse({})}
                                        className="flex items-center gap-2 px-4 py-2 rounded-lg bg-comet-orange text-white hover:bg-orange-600">
                                        <Icons.Plus /> New Course
                                    </button>
                                )}
                            </div>
                        </div>

                        <div className="flex gap-2 flex-wrap">
                            {categories.map(cat => (
                                <button key={cat} onClick={() => setFilterCategory(cat)}
                                    className={`px-4 py-2 rounded-full text-sm font-medium ${
                                        filterCategory === cat ? 'bg-comet-orange text-white' : 'bg-light-grey text-neutral-700 hover:bg-dark-grey'
                                    }`}>
                                    {cat}
                                </button>
                            ))}
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {filtered.map(course => (
                                <div key={course.id} onClick={() => setActiveCourse(course)}
                                    className="bg-white rounded-xl p-5 shadow-sm hover:shadow-md transition-all cursor-pointer border border-transparent hover:border-comet-orange/30">
                                    <div className="flex items-start justify-between mb-4">
                                        <div className="w-12 h-12 rounded-lg bg-light-grey flex items-center justify-center text-comet-orange">
                                            <Icons.FileText />
                                        </div>
                                        {course.status === 'completed' && <span className="text-classic-green"><Icons.CheckCircle /></span>}
                                        {course.status === 'in-progress' && (
                                            <span className="px-2 py-1 rounded-full text-xs bg-orange-100 text-comet-orange">In Progress</span>
                                        )}
                                    </div>
                                    <h3 className="font-semibold text-lg mb-2">{course.title}</h3>
                                    <p className="text-sm text-neutral-500 mb-3 line-clamp-2">{course.description}</p>
                                    <div className="flex items-center gap-3 text-sm text-neutral-500 mb-3">
                                        <span className="flex items-center gap-1"><Icons.Clock /> {course.duration}h</span>
                                        <span className="px-2 py-0.5 rounded-full text-xs bg-light-grey">{course.category}</span>
                                    </div>
                                    {course.progress > 0 && course.progress < 100 && (
                                        <div className="h-2 rounded-full bg-light-grey">
                                            <div className="h-2 rounded-full bg-comet-orange" style={{ width: `${course.progress}%` }} />
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            // Settings
            const SettingsView = () => {
                const [userName, setUserName] = useState(data.user.name);
                const handleSave = () => {
                    setData(prev => ({ ...prev, user: { ...prev.user, name: userName } }));
                    showNotification('Settings saved!');
                };
                const handleExport = () => {
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'cpd-learning-hub-backup.json';
                    a.click();
                    showNotification('Data exported!');
                };
                const handleImport = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            try {
                                const imported = JSON.parse(e.target.result);
                                setData(imported);
                                showNotification('Data imported successfully!');
                            } catch { showNotification('Invalid file', 'error'); }
                        };
                        reader.readAsText(file);
                    }
                };

                return (
                    <div className="space-y-6 max-w-2xl">
                        <h1 className="text-2xl font-bold text-neutral-900">Settings</h1>
                        
                        <div className="bg-white rounded-xl p-6 shadow-sm">
                            <h2 className="text-lg font-semibold mb-4">Profile</h2>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium mb-1">Your Name</label>
                                    <input type="text" value={userName} onChange={e => setUserName(e.target.value)}
                                        className="w-full px-4 py-2 rounded-lg border focus:outline-none focus:border-comet-orange" />
                                </div>
                                <div className="flex items-center gap-3">
                                    <input type="checkbox" id="isAdmin" checked={data.user.isAdmin}
                                        onChange={e => setData(prev => ({ ...prev, user: { ...prev.user, isAdmin: e.target.checked } }))}
                                        className="accent-comet-orange" />
                                    <label htmlFor="isAdmin" className="text-sm">Enable Admin Mode (add/edit courses)</label>
                                </div>
                                <button onClick={handleSave} className="px-6 py-2 rounded-lg bg-comet-orange text-white font-medium hover:bg-orange-600">
                                    Save Changes
                                </button>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl p-6 shadow-sm">
                            <h2 className="text-lg font-semibold mb-4">Data Management</h2>
                            <div className="flex gap-4 flex-wrap">
                                <button onClick={handleExport} className="flex items-center gap-2 px-4 py-2 rounded-lg bg-classic-green text-white hover:bg-green-700">
                                    <Icons.Download /> Export Data
                                </button>
                                <label className="flex items-center gap-2 px-4 py-2 rounded-lg bg-light-grey text-neutral-700 hover:bg-dark-grey cursor-pointer">
                                    <Icons.Upload /> Import Data
                                    <input type="file" accept=".json" onChange={handleImport} className="hidden" />
                                </label>
                            </div>
                            <p className="text-sm text-neutral-500 mt-3">Export your data to back up all courses and progress, or import previously exported data.</p>
                        </div>

                        <div className="bg-white rounded-xl p-6 shadow-sm border border-red-200">
                            <h2 className="text-lg font-semibold text-red-600 mb-4">Reset Data</h2>
                            <p className="text-neutral-500 mb-4">This will delete all courses, progress, and settings.</p>
                            <button onClick={() => {
                                if (confirm('Are you sure? This cannot be undone.')) {
                                    localStorage.removeItem('cpdHubDataV2');
                                    setData(getInitialData());
                                    showNotification('Data reset');
                                }
                            }} className="px-6 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700">
                                Reset Everything
                            </button>
                        </div>
                    </div>
                );
            };

            // Main Render
            return (
                <div className="min-h-screen flex bg-neutral-100 font-poppins">
                    <button onClick={() => setShowMobileMenu(!showMobileMenu)} 
                        className="md:hidden fixed top-4 left-4 z-50 p-2 rounded-lg bg-neutral-900 text-white">
                        {showMobileMenu ? <Icons.X /> : <Icons.Menu />}
                    </button>

                    <div className={`fixed md:static inset-y-0 left-0 z-40 w-64 bg-neutral-900 p-4 flex flex-col transform transition-transform ${showMobileMenu ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}`}>
                        <div className="mb-8 px-4 pt-8 md:pt-0">
                            <div className="flex items-center gap-2">
                                <div className="w-10 h-10 rounded-lg bg-comet-orange flex items-center justify-center">
                                    <span className="text-white font-bold text-xl">F</span>
                                </div>
                                <span className="text-white font-semibold text-lg">farillio</span>
                            </div>
                            <p className="text-xs mt-2 text-neutral-500">CPD Learning Hub</p>
                        </div>

                        <nav className="flex-1 space-y-1">
                            <NavItem icon={Icons.BarChart3} label="Dashboard" id="dashboard" />
                            <NavItem icon={Icons.BookOpen} label="Courses" id="courses" />
                            <NavItem icon={Icons.TrendingUp} label="My Progress" id="progress" />
                        </nav>

                        <div className="border-t border-gray-700 pt-4 mt-4">
                            <NavItem icon={Icons.Settings} label="Settings" id="settings" />
                        </div>
                    </div>

                    <div className="flex-1 p-4 md:p-8 overflow-auto pt-16 md:pt-8">
                        {activeLesson && activeCourse ? (
                            <LessonViewer 
                                course={activeCourse} 
                                lesson={activeLesson} 
                                onBack={() => setActiveLesson(null)}
                                onComplete={completeLesson}
                            />
                        ) : activeCourse ? (
                            <CourseDetail 
                                course={activeCourse} 
                                onBack={() => setActiveCourse(null)} 
                            />
                        ) : (
                            <>
                                {activeTab === 'dashboard' && <Dashboard />}
                                {activeTab === 'courses' && <CoursesList />}
                                {activeTab === 'progress' && (
                                    <div className="space-y-6">
                                        <h1 className="text-2xl font-bold">My Progress</h1>
                                        <div className="bg-white rounded-xl p-6 shadow-sm">
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <div>
                                                    <div className="flex justify-between mb-2">
                                                        <span className="text-neutral-500">Structured Hours</span>
                                                        <span className="font-semibold">{hours.structured} / {structuredRequired}h</span>
                                                    </div>
                                                    <div className="h-4 rounded-full bg-light-grey mb-4">
                                                        <div className="h-4 rounded-full bg-comet-orange" style={{ width: `${Math.min(100, (hours.structured / structuredRequired) * 100)}%` }} />
                                                    </div>
                                                    <div className="flex justify-between mb-2">
                                                        <span className="text-neutral-500">Unstructured Hours</span>
                                                        <span className="font-semibold">{hours.unstructured} / 14h</span>
                                                    </div>
                                                    <div className="h-4 rounded-full bg-light-grey">
                                                        <div className="h-4 rounded-full bg-classic-green" style={{ width: `${Math.min(100, (hours.unstructured / 14) * 100)}%` }} />
                                                    </div>
                                                </div>
                                                <div className="flex items-center justify-center">
                                                    <div className="text-center relative">
                                                        <ProgressRing progress={(hours.total / totalRequired) * 100} size={150} strokeWidth={12} />
                                                        <div className="absolute inset-0 flex flex-col items-center justify-center">
                                                            <span className="text-3xl font-bold text-comet-orange">{hours.total}h</span>
                                                            <span className="text-sm text-neutral-500">of {totalRequired}h</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="bg-white rounded-xl p-6 shadow-sm">
                                            <h2 className="text-lg font-semibold mb-4">Completed Courses</h2>
                                            {data.courses.filter(c => c.status === 'completed').map(course => (
                                                <div key={course.id} className="flex items-center justify-between p-3 rounded-lg bg-neutral-100 mb-2">
                                                    <div className="flex items-center gap-3">
                                                        <span className="text-classic-green"><Icons.CheckCircle /></span>
                                                        <div>
                                                            <p className="font-medium">{course.title}</p>
                                                            <p className="text-sm text-neutral-500">{course.duration}h â€¢ {course.completedDate}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                            {data.courses.filter(c => c.status === 'completed').length === 0 && (
                                                <p className="text-center text-neutral-500 py-8">No courses completed yet.</p>
                                            )}
                                        </div>
                                    </div>
                                )}
                                {activeTab === 'settings' && <SettingsView />}
                            </>
                        )}
                    </div>

                    {editingCourse && (
                        <CourseEditor
                            course={editingCourse.id ? editingCourse : null}
                            onSave={editingCourse.id ? (d) => updateCourse(editingCourse.id, d) : addCourse}
                            onClose={() => setEditingCourse(null)}
                        />
                    )}

                    {editingLesson && (
                        <LessonEditor
                            courseId={editingLesson.courseId}
                            lesson={editingLesson.lesson}
                            onSave={editingLesson.lesson 
                                ? (d) => updateLesson(editingLesson.courseId, editingLesson.lesson.id, d)
                                : (d) => addLesson(editingLesson.courseId, d)
                            }
                            onClose={() => setEditingLesson(null)}
                        />
                    )}

                    {notification && (
                        <div className={`fixed bottom-4 right-4 px-6 py-3 rounded-xl shadow-lg text-white font-medium z-50 ${
                            notification.type === 'error' ? 'bg-red-500' : 'bg-classic-green'
                        }`}>
                            {notification.message}
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<CPDLearningHub />);
    </script>
</body>
</html>
